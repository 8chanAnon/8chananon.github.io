<!DOCTYPE html><html><head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>YouTube</title>

<style type="text/css">

body {
  font-size: 17px; line-height: 20px;
  font-family: 'times new roman', serif; 
  color: maroon; background-color: navajowhite;
  text-align: center;
}

.widevid {
  width: 736px; height: 414px;
  position: relative; overflow: hidden;
  border: 2px solid red; background-color: indigo;
}

.widevid:fullscreen {
  border: none;
}

.msgbox {
  position: absolute; top: 36%; left: 40%; right: 40%; display: block;
  text-align: center; border-radius: 10px;
  color: paleturquoise; background-color: slateblue;
  font-style: italic; cursor: pointer;
}

iframe {
  width: 100%; height: 100%;
  position: absolute; border: none;
  background-color: transparent;
  pointer-events: auto;
}

input {
  height: 17px; font-size: 13px;
  font-family: verdana, sans-serif;
  border-width: 2px; border-style: solid;
  border-color: tan lemonchiffon lemonchiffon burlywood;
  padding: 3px 5px 3px 5px; caret-color: navy; outline: none;
}

input[type=radio] {
  vertical-align: middle; margin: -2px 1px 1px 2px;
  filter: contrast(1.0) brightness(1.2) opacity(90%);
}

table {
  display: inline-block; border: 3px solid green;
}

td.textbox {
  width: 30vw; max-width: 250px;
  padding: 0 2px 0 0; vertical-align: top;
  text-align: center; white-space: nowrap;
}

td.vidbox {
  font-size: 15px; line-height: normal;
  padding: 0 0 0 2px; vertical-align: middle;
  text-align: left; border-left: 1px solid firebrick;
}

button {
  width: auto; height: auto;
  font-size: 14px; line-height: 20px;
  padding: 2px 6px 0 6px; margin: 0;
  font-family: helvetica, sans-serif;
  color: darkblue; background-color: pink;
  outline: none; border-size: 2px; border-style: solid;
  border-color: #e8e8e8 #9c9c9c #9c9c9c #ececec;
}

button:hover:active {
  border-color: #a8a8a8 #f8f8f8 #f4f4f4 #acacac;
}

hr {
  border-color: thistle; border-style: solid; margin: 12px 0;
}

::selection {
  color: yellow; background-color: orchid;
}

r_ { color: crimson; }
g_ { color: seagreen; }
b_ { color: blue; }

</style></head><body onload="javascript:start()">

<h2 style="text-align:center;margin:7px 0 10px 0"><r_>YouTube Player</r_></h2>

<table><tr><td class="textbox">

<span style="display:block;font-size:22px;margin:15px 0 -8px">&#x1f408;</span>

<span style="display:inline-block;text-align:left">

<br><input type=radio name="tv" onclick="javascript:tv ('NOZKLtIIUZE')"> Hitler Rant
<br><input type=radio name="tv" onclick="javascript:tv ('m_MaJDK3VNE')"> Herding Cats
<br><input type=radio name="tv" onclick="javascript:tv ('0ZwfXUURS3g')"> Dukes of Hazzard
<br><input type=radio name="tv" onclick="javascript:tv ('uQJoar17jyo')"> Schiff Hits the Fan
<br><input type=radio name="tv" onclick="javascript:tv ('wLTGXblgUoc')"> Never Forget
<br><input type=radio name="tv" onclick="javascript:tv ('FnV0LqHd3h8')"> Make America Great Again
<br><input type=radio name="tv" onclick="javascript:tv ('0pKfxbCHLoU')"> AKB48: Sustainable
<br><input type=radio name="tv" onclick="javascript:tv ('kJAsn_vJyY4')"> Starship Enterprise
<br><input type=radio name="tv" onclick="javascript:tv ('74VHwppfHuI')"> The Best Is Yet To Come
<br><input type=radio name="tv" onclick="javascript:tv ('XkkvC3D_srM')"> March of the Frogs
<br><input type=radio name="tv" onclick="javascript:tv ('sGdWkl9M_TY')"> American Airman
<br><input type=radio name="tv" onclick="javascript:tv ('AzEBH6DZJVk')"> St. James Infirmary
<br><input type=radio name="tv" onclick="javascript:tv ('W-gngBsA_DI')"> I Told You So
<br><input type=radio name="tv" onclick="javascript:tv ('w8KQmps-Sog')"> Uprising
<br><input type=radio name="tv" onclick="javascript:tv ('D_XdjviX6gQ')"> Cat Scratch Fever
<br><input type=radio name="tv" onclick="javascript:tv ('kx-inoYmN2Q')"> Alley Cat

</span><span style="display:block;font-size:22px;margin:14px 0 0;transform:scale(-1,1)">&#x1f408;</span>

</td><td class="vidbox">

<div class="widevid"><h2 id="msg" class="msgbox">No Video</h2>
<iframe id="frame" autoplay allowfullscreen controls></iframe>

</div></td></tr></table>

<div style="margin:12px 0 12px 0">
<!--
<input type=radio name="format" style="vertical-align:middle" value="18" checked> 360p &nbsp;
<input type=radio name="format" style="vertical-align:middle" value="22"> 720p</span> &nbsp;&nbsp;
-->
<g_>All videos are 360p only</g_> &nbsp;
<input type=text style="width:350px"> &nbsp;&nbsp;
<button onclick="javascript:play_url()">Play</button> &nbsp;
<button onclick="javascript:clear_video()">Stop</button>

</div><r_>Note: age-gated videos will not work.</r_> (<g_>updated August 10, 2024</g_>)

<script>

var cors_bypass = "https://m3u8.justchill.workers.dev/?url=";
var cors_kraker = "https://kraker-remote.vercel.app/?url=";

var response, textData, jsonData, busy = 0, cookies = {};
var line = document.querySelector ("input[type=text]");

var start = function ()
{
  if (location.hostname == "localhost") cors_bypass = cors_kraker = "/";
}

var clear_video = function ()
{
  var vid = document.getElementById ("frame"), win = vid.parentNode;
  win.removeChild (vid); vid.src = "about:blank"; win.appendChild (vid);
  document.getElementById ("msg").innerHTML = "No Video";
}
////////////////////

var is_busy = function ()
{
  if (busy) return 1;
  document.getElementById ("msg").innerHTML = "Busy";
  busy = 1; return 0;
}
////////////////////

var no_fail = function ()
{
  if (!busy) document.getElementById ("msg").innerHTML = "Error";
  var Busy = busy; busy = 0; return (Busy);
}
////////////////////

var pullstring = function (s, t, u)
{
  var m = t.length, n = s.indexOf (t) + m;
  m = n < m ? -1 : (u ? s.indexOf (u, n) : s.length);
  return (m < 0 ? "" : s.substr (n, m - n));
}
////////////////////

var tv = function (id)
{
  line.value = "https://www.youtube.com/watch?v=" + id;
  clear_video(); request_youtube (id, 18);
}
////////////////////

var play_url = function ()
{
  var m, n, s, url = line.value.trim();

  if (url.includes ("youtube") || url.includes ("youtu.be"))
  {
    if ((n = url.indexOf ("?")) >= 0)
    {
      s = url.substr (n); url = url.substr (0, n);
      m = pullstring (s, "?v=", "") || pullstring (s, "&v=", "");
      if ((n = m.indexOf ("&")) >= 0) m = m.substr (0, n); if (m) url = "/" + m;
    }
    url = (n = url.lastIndexOf ("/")) < 0 ? "" : url.substr (n + 1);
  }

  if (url.length == 11) tv (url); else line.value = "Invalid";
}
////////////////////

const request_youtube = async (id, fmt) =>
{
  var n, s, t, sub, vid, key, sig, nkey, f = [0,0,0,0,0,0,0,0,0,0];

  if (is_busy()) return; var url = cors_bypass + "https://www.youtube.com/watch?v=" + id;

try
{
  response = await fetch (url);
  textData = await response.text();

  sub = pullstring (textData, '"formats":[', ']');

  if (!(s = pullstring (textData, '"jsUrl":"', '"'))) throw ("!!!");

  if (!(key = cookies [s]) || !(nkey = cookies ["!" + s]))
  {
    response = await fetch (cors_kraker + "https://www.youtube.com" + s);
    textData = await response.text();

    if ((n = textData.indexOf ('var b=a.split(a.slice(0,0))')) < 0) nkey = ""; else
    {
      t = textData.substr (n, textData.indexOf ('b.join("")', n) - n);
      t = 'function(a){var b=a.split(""' + t.substr (t.indexOf ('),')) + 'b.join("")};';
      nkey = "var nsig=" + t + " sig=nsig(sig);";
    }

    cookies [s] = key = yt_algo (textData); cookies ["!" + s] = nkey;
  }

  sub = JSON.parse ('{"formats":[' + sub + ']}');
  sub = sub.formats; if (!sub.length) throw ("!!!");

  vid = yt_split (sub [0]); url = vid [0]; sig = vid [1]; if (!url) throw ("!!!");
  url = yt_nsig (url, nkey); if (sig && key) { eval (key); url += "&sig=" + sig; }

} catch (err) { console.log (err); busy = 0; }

  if (no_fail()) load_stream (url);
}
////////////////////

var yt_split = function (data)
{
  var d, i, r, s, u = data.url; i = r = s = "";

  if (!u) if (!(u = data.signatureCipher)) u = ""; else
  {
    u = u.replace (/%25/g, "%"); u = decodeURIComponent (u);
    s = pullstring (u, "s=", "&"); u = pullstring (u, "url=", "");
  }

  i = (d = data.initRange)  ? d.start + "-" + d.end : "";
  r = (d = data.indexRange) ? d.start + "-" + d.end : "";

  if (!(d = data.approxDurationMs)) d = 0;

  return ([u, s, d / 1000, i + "," + r]);
}
////////////////////

var yt_algo = function (data)
{
  var i, j, n, s, v;

  for (i = 0; i < 3; i++)
  {
    j = data.indexOf ('a=a.split("")'); if (j < 0) return "";
    s = data.substr (j + 14, 300); if ((n = s.indexOf ("a.join")) > 0) break;
    if (i > 1) return ""; data = data.substr (j + 1);
  }

  s = s.substr (0, n - 7);
  v = "var " + s.substr (0, s.indexOf (".")) + "={";
  if ((n = data.indexOf (v)) < 0) return "";

  v = data.substr (n, 300); v = v.substr (0, v.indexOf ("};") + 2);
  return (v + "var a=sig.split('');" + s + "sig=a.join('');");
}
////////////////////

var yt_nsig = function (url, nkey)
{
  var sig = pullstring (url, "&n=", "&"); if (!nkey || !sig) return url;
  var s = "&n=" + sig + "&"; eval (nkey); sig = "&n=" + sig + "&";
  return (url.replace (s, sig));
}
////////////////////

var load_stream = function (url)
{
  var bstyle = "<body style='margin:0;padding:0;overflow:hidden;background-color:";
  var istyle = " style='position:absolute;border:none;outline:none;width:100%;height:100%'";
  var vstyle = " autoplay controls allowfullscreen ";

  var insert = bstyle + "black'><video" + istyle + vstyle + "id='video'></video></body>";

  var doc = document.getElementById ("frame").contentDocument;
  doc.open(); doc.write ("<!DOCTYPE html>" + insert); doc.close();
  doc.getElementById ("video").src = url;
}
////////////////////

</script></body></html>

